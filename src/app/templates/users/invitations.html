{% extends "base.html" %}

{% block title %}Pending Invitations{% endblock %}

{% block content %}
<div class="container">
    <div class="section-header">
        <h1>Pending Invitations</h1>
        <div class="actions">
            <a href="{{ url_for('users.add') }}" class="btn btn-primary">
                <i class="fas fa-user-plus"></i> Invite User
            </a>
            <a href="{{ url_for('users.index') }}" class="btn btn-outline-primary">
                <i class="fas fa-users"></i> View Users
            </a>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            {% if invitations %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Sent By</th>
                        <th>Sent Date</th>
                        <th>Expires</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for invitation in invitations %}
                    <tr>
                        <td>{{ invitation.email }}</td>
                        <td>
                            <span class="badge badge-primary">{{ invitation.role.name }}</span>
                        </td>
                        <td>{{ invitation.creator.username }}</td>
                        <td>{{ invitation.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>{{ invitation.expires_at.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>
                            <button class="btn btn-sm btn-info copy-btn"  style="display: flex; align-items: center;"
                                    data-url="{{ url_for('users.register', token=invitation.token, _external=True) }}"
                                    title="Copy invitation link">
                                <i class="fas fa-copy"></i>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty-state">
                <i class="fas fa-envelope-open fa-3x"></i>
                <h3>No Pending Invitations</h3>
                <p>There are no active invitations at this time.</p>
                <a href="{{ url_for('users.add') }}" class="btn btn-primary" >
                    <i class="fas fa-user-plus" ></i> Invite User
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .actions {
        display: flex;
        gap: 10px;
    }
    
    .card {
        background-color: var(--background-color);
        border-radius: 8px;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-color);
        margin-bottom: 20px;
    }
    
    .card-body {
        padding: 20px;
    }
    
    .table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .table th, .table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
    }
    
    .table th {
        font-weight: 600;
        color: var(--light-text);
    }
    
    .badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
    }
    
    .badge-primary {
        background-color: var(--primary-color);
        color: white;
    }
    
    .empty-state {
        text-align: center;
        padding: 40px 0;
        color: var(--light-text);
    }
    
    .empty-state i {
        color: var(--border-color);
    
    }
    
    .empty-state h3 {
        margin-bottom: 10px;
        color: var(--text-color);
    }
    
    .empty-state p {
        margin-bottom: 20px;
    }
    
    .btn {
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        border: none;
    }
    
    .btn-primary {
        background-color: var(--primary-color);
        color: white;
    }
    
    .btn-primary:hover {
        background-color: var(--primary-hover);
    }
    
    .btn-outline-primary {
        background-color: transparent;
        color: var(--primary-color);
        border: 1px solid var(--primary-color);
    }
    
    .btn-outline-primary:hover {
        background-color: var(--primary-color);
        color: white;
    }
    
    .btn-sm {
        padding: 4px 8px;
        font-size: 12px;
    }
    
    .btn-info {
        background-color: var(--warning-color);
        color: white;
    }
</style>

<script>
$(document).ready(function() {
    $('.copy-btn').on('click', function() {
        var url = $(this).data('url');
        
        // Create temporary input
        var tempInput = document.createElement('input');
        tempInput.value = url;
        document.body.appendChild(tempInput);
        
        // Select and copy
        tempInput.select();
        document.execCommand('copy');
        document.body.removeChild(tempInput);
        
        // Show feedback
        var originalContent = $(this).html();
        $(this).html('<i class="fas fa-check"></i>');
        
        setTimeout(function(btn, original) {
            $(btn).html(original);
        }, 1500, this, originalContent);
    });
});
</script>
{% endblock %}
